<head>
  <title>PXE-Server</title>
  <link rel="shortcut icon" href="./logo.png" type="image/png">
</head>
 <head>
  <meta charset="utf-8">
 </head>
<style>
.neonText1 {
  color: #87CEFA;
  text-shadow:
      0 0 1px #4169E1,
      0 0 1px #4169E1,
      0 0 1px #4169E1,
      0 0 1px #4169E1,
      0 0 1px #4169E1,
      0 0 1px #4169E1,
      0 0 1px #4169E1,
      0 0 1px #4169E1;
}
.neonText2 {
  color: #00FF00;
  text-shadow:
      0 0 1px #006400,
      0 0 1px #006400,
      0 0 1px #006400,
      0 0 1px #006400,
      0 0 1px #006400,
      0 0 1px #006400,
      0 0 1px #006400,
      0 0 1px #006400;
}
/* Additional styling */
body{
    background-color: black;
    background-repeat: no-repeat;
    background-size: cover;
    background-attachment: fixed;
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
    color: #cfcfcf;
}
a {
    text-decoration: none;
}
p {
  text-indent: 1.5em;
  font-family: monospace;
  font-weight: 500;
  white-space: pre;
  line-height: 2;
  letter-spacing: 1px;
}
</style>
<div class="container">
<p class="neonText1">
Установка/настройка PXE-Server-@ на OC Linux RedOS 7.3.1 Workstation
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------
!!!ВНИМАНИЕ!!! В данном примере создается изолированный сегмент сети, т.е. не нужно подключать к общей сети организации, т.к. может возникнуть конфликт DHCP-адресов.
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------
При создании виртуаки рекомендуется выделить: Sockets: 2; Cores: 2; Memory(MiB): 8192.
------------
<a class="neonText2">yum update -y && yum upgrade -y && yum install -y dhcp tftp-server syslinux httpd</a> |#|#| Установка требуемых пакетов для дальнейшей корректной работы PXE-Server-@ and OC
------------
После установки рабочей станции, обязательно нужно прописать статику(пример):
IP-адрес: 192.168.2.2; Mask: 255.255.255.0(24); Gateway: 192.168.2.2; Серверы DNS: 192.168.2.2.
------------
<a class="neonText2">reboot</a> |#|#| Команда для перезагрузки АРМ/VM
------------
Создадим следующие каталоги:

<a class="neonText2">mkdir /var/lib/tftpboot/pxelinux.cfg</a>
------------
<a class="neonText2">mkdir /var/lib/tftpboot/uefi</a>
------------
<a class="neonText2">mkdir -p /var/lib/tftpboot/images/REDOS</a>
------------
Копируем нужные нам файлы для запуска установки ОС RedOS 7.3.1 по сети в режиме Legacy:

<a class="neonText2">cp /usr/share/syslinux/chain.c32 /var/lib/tftpboot/</a>
------------
<a class="neonText2">cp /usr/share/syslinux/mboot.c32 /var/lib/tftpboot/</a>
------------
<a class="neonText2">cp /usr/share/syslinux/memdisk /var/lib/tftpboot/</a>
------------
<a class="neonText2">cp /usr/share/syslinux/menu.c32 /var/lib/tftpboot/</a>
------------
<a class="neonText2">cp /usr/share/syslinux/pxelinux.0 /var/lib/tftpboot/</a>
------------
<a class="neonText2">cp /usr/share/syslinux/ldlinux.c32 /var/lib/tftpboot/</a>
------------
<a class="neonText2">cp /usr/share/syslinux/libutil.c32 /var/lib/tftpboot/</a>
------------
<a class="neonText2">chmod 777 /var/lib/tftpboot/pxelinux.0</a> |#|#| Выдача полных прав доступа для владельца файла, участников группы и всех остальных.
------------
Выполняем последовательность команд для запуска установки ОС RedOS 7.3.1 по сети в режиме UEFI:

<a class="neonText2">dnf download shim-x64 grub2-efi-x64 --downloaddir=/root/</a>
------------
<a class="neonText2">cd /root/</a>
------------
<a class="neonText2">rpm2cpio shim-x64-*.rpm | cpio -dimv</a>
------------
<a class="neonText2">rpm2cpio grub2-efi-x64-*.rpm | cpio -dimv</a>
------------
<a class="neonText2">cp ./boot/efi/EFI/BOOT/BOOTX64.EFI /var/lib/tftpboot/uefi</a>
------------
<a class="neonText2">cp ./boot/efi/EFI/redos/grubx64.efi /var/lib/tftpboot/uefi</a>
------------
<a class="neonText2">chmod 777 /var/lib/tftpboot/uefi/*.*</a>
------------
Копируем все файлы из iso-образа RedOS 7.3.1 в каталог "/var/lib/tftpboot/images/REDOS":

<a class="neonText2">cp -vR "/run/media/user/redos-MUROM-7.3.1 x86_64/." /var/lib/tftpboot/images/REDOS</a>
------------
<a class="neonText2">mount -t iso9660 -o loop redos-MUROM-7.2-x86_64-DVD1.iso /mnt/</a> |#|#| Монтирование образа
------------
<a class="neonText2">cp -vR /mnt/* /var/lib/tftpboot/images/REDOS/</a> |#|#| Копирование файлов
------------
<a class="neonText2">umount /mnt/</a> |#|#| Размонтировать образ
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Настройка DHCP-Server-a
------------
<a class="neonText2">nano /etc/dhcp/dhcpd.conf</a> |#|#| Переходим в редактирование конфигурационного файла dhcpd.conf
------------
Далее прописываем следующий конфиг:
<a class="neonText2">
non-authoritative;
allow bootp;
option space pxelinux;
option pxelinux.magic code 208 = string;
option pxelinux.configfile code 209 = text;
option pxelinux.pathprefix code 210 = text;
option pxelinux.reboottime code 211 = unsigned integer 32;
option architecture-type code 93 = unsigned integer 16;

subnet 192.168.2.0 netmask 255.255.255.0 {
        option routers 192.168.2.2;
        range 192.168.2.70 192.168.2.80;

        class "pxeclients" {
          match if substring (option vendor-class-identifier, 0, 9) = "PXEClient";
          next-server 192.168.2.2;
          if option architecture-type = 00:07 {
             filename "uefi/grubx64.efi";
             } 
          else {
               filename "pxelinux.0";
          }
   }
}</a>
------------
<a class="neonText2">systemctl enable dhcpd</a> |#|#| Добавление службы dhcpd в автозапуск
------------
<a class="neonText2">systemctl start dhcpd</a> |#|#| Запуск службы dhcpd
------------
Создание загрузочного меню для сетевой установки ОС RedOS 7.3.1 в режиме Legacy:
<a class="neonText2">
nano /var/lib/tftpboot/pxelinux.cfg/default</a> |#|#| Редактирование конфигурационного файла default
------------
Далее прописываем следующий конфиг(адрес 192.168.2.2 меняем на тот, с которого загружается образ):
<a class="neonText2">
default menu.c32
PROMPT 0
TIMEOUT 150
MENU TITLE PXE Menu
LABEL REDOS 7.3
MENU LABEL REDOS 7.3
KERNEL images/REDOS/images/pxeboot/vmlinuz
APPEND initrd=images/REDOS/images/pxeboot/initrd.img ramdisk_size=128000 ip=dhcp inst.repo=http://192.168.2.2/images/REDOS/</a>
------------
Создание загрузочного меню для сетевой установки ОС RedOS 7.3.1 в режиме UEFI:
<a class="neonText2">
nano /var/lib/tftpboot/uefi/grub.cfg</a> |#|#| Редактирование конфигурационного файла grub.cfg
------------
Далее прописываем следующий конфиг(адрес 192.168.2.2 меняем на тот, с которого загружается образ):
<a class="neonText2">
function load_video {
        insmod efi_gop
        insmod efi_uga
        insmod video_bochs
        insmod video_cirrus
        insmod all_video
}

load_video
set gfxpayload=keep
insmod gzio

menuentry 'REDOS 7.3' {
        linux images/REDOS/images/pxeboot/vmlinuz ip=dhcp inst.repo=http://192.168.2.2/images/REDOS/
        initrd images/REDOS/images/pxeboot/initrd.img
}</a>
------------
Конфигурирование Web-Server-@ HTTPD:
<a class="neonText2">
nano /etc/httpd/conf.d/pxeboot.conf</a> |#|#| Создание и редактирование конфигурационного файла pxeboot.conf
------------
Далее прописываем следующий конфиг:
<a class="neonText2">
Alias /images /var/lib/tftpboot/images
&lt;Directory /var/lib/tftpboot/images&gt;
    Options Indexes FollowSymLinks
    # access permission
    Require ip 127.0.0.1 192.168.2.0/24
&lt;/Directory&gt;</a>
------------
<a class="neonText2">systemctl enable httpd</a> |#|#| Добавление службы httpd в автозапуск
------------
<a class="neonText2">systemctl start httpd</a> |#|#| Запуск службы httpd
------------
Настройка и запуск службы TFTP:
<a class="neonText2">
nano /usr/lib/systemd/system/tftp.service</a> |#|#| Редактирование конфигурационного файла tftp.service

В секцию [Install], перед строкой "Also=tftp.socket" нужно добавить строку "WantedBy=multi-user.target"
------------
<a class="neonText2">systemctl enable tftp</a> |#|#| Добавление службы tftp в автозапуск
------------
<a class="neonText2">systemctl start tftp</a> |#|#| Запуск службы tftp
------------
Если selinux находится в статусе enforcing, то создайте модуль политики безопасности selinux, для разрешения доступа с клиентов к web-серверу, который участвует в
установке РЕД ОС по сети.
------------
<a class="neonText2">ausearch -c 'httpd' --raw | audit2allow -M my-httpd</a>
------------
<a class="neonText2">semodule -i my-httpd.pp</a>
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------
На этом инструкция завершена! Спасибо за внимание!
</p>
</div>
